<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SwitchBot起動</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- =======================
       CSS：中央配置・文字スタイル + 右下バージョン表示
       ======================= -->
  <style>
    /* 基本設定：画面全体を使用し、中央配置 */
    html, body {
      height: 100%;               /* 画面全体を使用 */
      margin: 0;                  /* デフォルト余白を削除 */
      padding: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f8f8f8;
      display: flex;
      flex-direction: column;     /* 上下方向に要素を配置 */
      justify-content: center;    /* メインコンテンツを垂直中央に配置 */
      align-items: center;        /* 水平方向中央 */
    }

    /* メインメッセージ */
    .message {
      font-size: 20px;           /* 文字を少し大きくして強調 */
      font-weight: bold;
      color: #333;
      line-height: 1.5;          /* 行間 */
      margin: 0 20px;            /* 横余白でスマホ画面にフィット */
    }

    /* 完了ボタン */
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }

    /* =======================
         バージョン表示：右下に固定
         ======================= */
    .version {
      position: fixed;           /* 画面に固定 */
      bottom: 10px;              /* 下から10px */
      right: 10px;               /* 右から10px */
      font-size: 10px;           /* 小さめ文字 */
      color: #666;
      text-align: right;         /* 右寄せ */
    }
  </style>

  <!-- =======================
       JavaScript：アプリ起動＆ストア誘導
       ======================= -->
  <script>
    window.onload = function() {

      // ① バージョン番号を一括管理
      var appVersion = "V05";

      // ② アプリURLスキーム（キャッシュバスターとしてバージョン付与）
      var appURL = "switchbot://?v=" + appVersion;

      // ③ iOS App Store URL（キャッシュバスター付与）
      var storeURL_iOS = "https://apps.apple.com/jp/app/switchbot/id1087374761?v=" + appVersion;

      // ④ Android Google Play URL（キャッシュバスター付与）
      var storeURL_Android = "https://play.google.com/store/apps/details?id=com.theswitchbot.switchbot&v=" + appVersion;

      // ⑤ ユーザーエージェント取得（端末判定用）
      var ua = navigator.userAgent || navigator.vendor || window.opera;

      // =======================
      // iOS端末判定
      // =======================
      if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
        // アプリを起動（インストール済みなら即起動）
        window.location.href = appURL;

        // 2秒後にApp Storeに誘導（未インストール時のフォールバック）
        setTimeout(function(){
          window.location.href = storeURL_iOS;
        }, 2000);
      }

      // =======================
      // Android端末判定
      // =======================
      else if (/android/i.test(ua)) {
        // Intentスキームを使用すると
        // 1) アプリがインストール済みなら直接起動
        // 2) 未インストールならGoogle Playに誘導
        var intentURL = "intent://#Intent;scheme=switchbot;package=com.theswitchbot.switchbot;S.browser_fallback_url=" 
                        + encodeURIComponent(storeURL_Android) + ";end";
        window.location.href = intentURL;
      }

      // =======================
      // その他端末（PCなど）
      // =======================
      else {
        document.body.innerHTML = "<p class='message'>スマートフォンからアクセスしてください。</p>";
      }

      // =======================
      // 右下バージョン表示に反映
      // =======================
      var versionElem = document.getElementById("version");
      if(versionElem) {
        versionElem.textContent = "バージョン: " + appVersion;
      }
    }
  </script>
</head>
<body>
  <!-- =======================
       メインメッセージ
       ======================= -->
  <p class="message">
    SwitchBotアプリを起動しました。<br><br>
    完了したらこの画面を閉じてください。<br>
    <button onclick="window.close()">完了</button>
  </p>

  <!-- =======================
       右下にバージョン表示
       ======================= -->
  <div class="version" id="version"></div>
</body>
</html>
